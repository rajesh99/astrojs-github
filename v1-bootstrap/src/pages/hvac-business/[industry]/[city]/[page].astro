---
import config from "../../../../../config";
import Cities from "@src/data/Cities";
import Industries from "@src/data/Industries";
import SiteLayout from "@src/layouts/SiteLayout.astro";
import herobg from "@assets/assets/images/banners/banner1.jpg"
import location from "@assets/images/location.svg"
import calender from "@assets/images/calender.svg"

const slug = Astro.params




export async function getStaticPaths({ paginate }) {
  // Load your data with fetch(), Astro.glob(), etc.

 
 var formattedCities = [];
 for(let i=0; i< Cities.length; i++) {
    for(let j=0; j<Industries.length; j++) {
        
   const category = Industries[j].name.split("-").map((word) => word[0].toUpperCase()  + word.slice(1).toLowerCase()).join(" ");
    const city =  Cities[i].name.toString().split("-").map((word) => word[0].toUpperCase()  + word.slice(1).toLowerCase()).join(" ");

   const query =category  +  " in " + city;
   var Contractors = [];

  
 
const response = await fetch(`https://maps.googleapis.com/maps/api/place/textsearch/json?query=${query}&key=${config.api_key}`);
const data = await response.json();
Contractors = data.results;

      formattedCities.push({
        city:Cities[i].cleanUrl,
        industry:Industries[j].cleanUrl,
        Contractors:Contractors
      })
    }
 }
 

  return  formattedCities.map(  (tag) => {




    const paginated =  paginate(tag.Contractors, {
      params: { industry:tag.industry.split(" ").join("-").toLowerCase(), city:tag.city.split(" ").join("-").toLowerCase() },
      pageSize: 15
    });

    return paginated;
  });
}

// If set up correctly, The page prop now has everything that
// you need to render a single page (see next section).
const { page } = Astro.props;

---
<!-- ... -->

<SiteLayout>

        <section class="breadcrumb-section">
            <div class="container">
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item"><a href="/directory/index.html">Home</a></li>
                    <li class="breadcrumb-item"><a href={ "/directory/" + slug.industry + "-search.html"}>{slug.industry.toString().split("-").map((word) => word[0].toUpperCase()  + word.slice(1).toLowerCase()).join(" ")}</a></li>
                    <li class="breadcrumb-item active" aria-current="page">{slug.city.toString().split('-').map((word) => word[0].toUpperCase()  + word.slice(1).toLowerCase()).join(" ")}</li>
                </ol>    
            </div>
        </section>

        <section class="contractors-section">
            <div class="container">
               <div class="my-0">
     <div class="mx-1">
       <div class="row">


           <div class="col-xl-6 col-md-6 m-0 p-0 "> 
           <div class="card px-0 mx-0"> 
           
            <div class="item-card">
                    <div class="item-card-desc">
                            <a href="#"></a>
                            <div class="item-card-img">
                            <img src={`/directory${herobg}`} alt="img" class="br-te-7 br-ts-7"> 
                            </div>
                            <div class="item-card-text">
                            
                            </div>
                   </div>
            </div>
       </div>
            </div>
       </div>
     </div>
</div>



                  <div class=" py-4">
        {page.data.map(item=> {
   return(
       (
           <div>
           <div class="card overflow-hidden">
    <div class="d-md-flex">
        <div class="item-card9-img">
           
            <div class="item-card9-imgs"> <a href="software.html"></a> <img src={item.icon } alt="img" height="200" width="200" class="cover-image"> </div>
            <div class="item-card9-icons"> <a href="#" class="item-card9-icons1"> <i class="fa fa fa-heart-o"></i></a> </div>
        </div>
        <div class="card border-0 mb-0">
            <div class="card-body ">
                <div class="item-card9"> <a href="#">
                 <div class="d-flex flex-wrap pt-4  gap-2">
                                <div class="d-flex align-items-center me-md-3">
                                    <img src={'/directory/' + location} class="me-2">
                                    <p class="mb-0">{item.plus_code?.compound_code}</p>
                                </div>
                                <div class="d-flex align-items-center">
                                    <img src={'/directory/' + calender} class="me-2">
                                    <p class="mb-0">{item.business_status === "OPERATIONAL" ? "Monday - Friday" : "Not Operational"}</p>
                                </div>
                            </div>
               </a>
                    <a href="software.html" class="text-dark">
                        <h4 class="font-weight-semibold mt-1">{item.name} </h4>
                    </a>
                    <p class="mb-0 leading-tight">Address:{item.formatted_address}</p>
                </div>
            </div>
            <div class="card-footer pt-4 pb-4">
                <div class="item-card9-footer d-flex">
                    <div class="item-card9-cost">
                        <h4 class="text-dark font-weight-semibold mb-0 mt-0">{item.user_ratings_total} Votes</h4>
                    </div>
                    <div class="ms-auto">
                        <div class="rating-stars block"> <input type="number" readonly="readonly" class="rating-value star" name="rating-stars-value" value="3">
                            <div class="rating-stars-container">
                            {[1,2,3,4,5].map(rate =>  {
                               return  item.rating >=rate ? (<div class="rating-star sm is--active"> <i class="fa fa-star"></i> </div>) : (<div class="rating-star sm"> <i class="fa fa-star"></i> </div>)
                            })}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

        
</div>
)
   )
                    })

                    }

                    <div class=" d-none d-lg-block">
 
                        <ul class="pagination">
                            <li class={ page.url.prev ? "page-item page-prev " :"page-item page-prev disabled"}><a class="page-link" href={page.url.prev ? '/directory' + page.url.prev.slice(0, -1) + ".html" : "#"}>Prev</a></li>
                      
                            {[...Array(page.lastPage > 4 ? 4 : (page.lastPage - page.currentPage) + 1).keys()].map(item => {
                              return (  <li class={page.currentPage== (item + page.currentPage) ? "page-item active" : "page-item"}><a class="page-link" href={`/directory/hvac-business/${slug.industry}/${slug.city}/${item + page.currentPage}.html`}>{item + page.currentPage  }</a></li>)
                            })}
                           
                            <li class={page.url.next ? "page-item page-next": "page-item page-next disabled"}><a class="page-link"  href={page.url.next ? '/directory' + page.url.next.slice(0, -1) + ".html" : "#"}>Next</a></li>
                        </ul>
                    </div>
                    <div class="reload d-lg-none text-center">
                        <a href="#"><i class="fa-solid fa-arrow-rotate-right pe-2"></i><span>Load More</span></a>
                    </div>

                </div>
            </div>
        </section>


</SiteLayout>