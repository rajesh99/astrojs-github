---
import config from "../../../../../config";
import Cities from "../../../../data/Cities";
import Industries from "../../../../data/Industries";
import SiteLayout from "../../../../layouts/SiteLayout.astro";
const slug = Astro.params




export async function getStaticPaths({ paginate }) {
  // Load your data with fetch(), Astro.glob(), etc.
 const allTags = ['red', 'blue', 'green'];
 
 var formattedCities = [];
 for(let i=0; i< Cities.length; i++) {
    for(let j=0; j<Industries.length; j++) {
        
   const category = Industries[j].name.split("-").map((word) => word[0].toUpperCase()  + word.slice(1).toLowerCase()).join(" ");
    const city =  Cities[i].name.toString().split("-").map((word) => word[0].toUpperCase()  + word.slice(1).toLowerCase()).join(" ");

   const query =category  +  " in " + city;
   var Contractors = [];

  
 
const response = await fetch(`https://maps.googleapis.com/maps/api/place/textsearch/json?query=${query}&key=${config.api_key}`);
const data = await response.json();
Contractors = data.results;

      formattedCities.push({
        city:Cities[i].name,
        industry:Industries[j].name,
        Contractors:Contractors
      })
    }
 }
 


 const allPosts = ["Post1","pis-2"];
  return  formattedCities.map(  (tag) => {




    const paginated =  paginate(tag.Contractors, {
      params: { industry:tag.industry.split(" ").join("-").toLowerCase(), city:tag.city.split(" ").join("-").toLowerCase() },
      pageSize: 10
    });

    return paginated;
  });
}

// If set up correctly, The page prop now has everything that
// you need to render a single page (see next section).
const { page } = Astro.props;


---
<!-- ... -->

<SiteLayout>

        <section class="breadcrumb-section">
            <div class="container">
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                    <li class="breadcrumb-item"><a href="#">{slug.industry.toString().split("-").map((word) => word[0].toUpperCase()  + word.slice(1).toLowerCase()).join(" ")}</a></li>
                    <li class="breadcrumb-item active" aria-current="page">{slug.city.toString().split('-').map((word) => word[0].toUpperCase()  + word.slice(1).toLowerCase()).join(" ")}</li>
                </ol>    
            </div>
        </section>

        <section class="contractors-section">
            <div class="container">
                <div class="main-head d-flex align-items-center ">
                    <div class="bg-light-blue img-icon">
                        <img src="../../../../images/hvac-contractors.svg">
                    </div>
                    <div class="heading">
                        <h3>{slug.industry.toString().split("-").map((word) => word[0].toUpperCase()  + word.slice(1).toLowerCase()).join(" ")}</h3>
                    </div>
                </div>


                  <div class="contractors-list">
                    {page.data.map(item=> {
   return(
       (<div class="contractors-box d-flex justify-content-between">
                        <div class="contractors-img">
                            <img src={ item.icon}>
                        </div>
                        <div class="contractors-info">
                            <div class="d-flex justify-content-between me-auto contractors-content">
                                <div class="heading me-2">
                                    <h3 class="mb-3 font-w-700">{item.name}</h3>
                                    <p>{item.types.toString()}</p>
                                </div>
                                <div class="contractors-review">
                                    <div class="green-box d-flex align-items-center">
                                        <img src="../../../../../images/star-icon.svg"><span>{item.rating}</span>
                                    </div>
                                    <p>{item.user_ratings_total} reviews</p>
                                </div>
                            </div>
                            <div class="d-flex pt-4 location-time">
                                <div class="d-flex align-items-center me-md-3">
                                    <img src="../../../../../images/location.svg" class="me-2">
                                    <p class="mb-0">{item.plus_code.compound_code}</p>
                                </div>
                                <div class="d-flex align-items-center">
                                    <img src="../../../../../images/calender.svg" class="me-2">
                                    <p class="mb-0">{item.business_status === "OPERATIONAL" ? "Monday - Friday" : "Not Operational"}</p>
                                </div>
                            </div>
                            
                        </div>
                    </div>)
   )
                    })

                    }

                    <div class="pagintaion d-none d-lg-block">
                        <ul>
                            <li><a href={page.url.prev ? page.url.prev : "#"}><i class="fa-solid fa-angle-left"></i></a></li>
                      
                            {[...Array(page.lastPage > 3 ? 4 : page.lastPage).keys()].map(item => {
                              return (  <li><a href={`/hvac-business/${slug.industry}/${slug.city}/${item + page.currentPage}`}>{item + page.currentPage  }</a></li>)
                            })}
                            <li><a href="#">...</a></li>
                            <li><a href={page.url.next ? page.url.next : "#"}><i class="fa-solid fa-angle-right"></i></a></li>
                        </ul>
                    </div>
                    <div class="reload d-lg-none text-center">
                        <a href="#"><i class="fa-solid fa-arrow-rotate-right pe-2"></i><span>Load More</span></a>
                    </div>

                </div>
            </div>
        </section>


</SiteLayout>